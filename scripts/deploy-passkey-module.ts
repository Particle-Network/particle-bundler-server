import { FetchRequest, JsonRpcProvider, Network, Wallet } from 'ethers';
import { PROVIDER_FETCH_TIMEOUT } from '../src/common/common-types';
import { getBundlerChainConfig } from '../src/configs/bundler-common';

const data = `0x00000000000000000000000000000000000000000000000000000000000000006080806040523461001657611f13908161001c8239f35b600080fdfe60806040526004361015610013575b600080fd5b6000803560e01c908163032ff9f11461010f5781631626ba7e1461010f5781637301609614610090575080638d2bc52914610087578063a3f4df7e1461007e578063ffa1ad74146100755763fff35b721461006d57600080fd5b61000e610540565b5061000e6104c2565b5061000e610458565b5061000e6103be565b3461010c57606036600319011261010c5760443567ffffffffffffffff9182821161010c573660238301121561010c57816004013592831161010c57366024848401011161010c576101086100ee84602485016024356004356105e1565b6040516001600160a01b0390911681529081906020820190565b0390f35b80fd5b505061000e61021b565b50634e487b7160e01b600052604160045260246000fd5b6060810190811067ffffffffffffffff82111761014c57604052565b610154610119565b604052565b90601f8019910116810190811067ffffffffffffffff82111761014c57604052565b6040519060c0820182811067ffffffffffffffff82111761014c57604052565b60209067ffffffffffffffff81116101b9575b601f01601f19160190565b6101c1610119565b6101ae565b9291926101d28261019b565b916101e06040519384610159565b82948184528183011161000e578281602093846000960137010152565b9080601f8301121561000e57816020610218933591016101c6565b90565b503461000e57604036600319011261000e5760243567ffffffffffffffff811161000e5761025a61025260209236906004016101fd565b600435610a95565b6040517fffffffff000000000000000000000000000000000000000000000000000000009091168152f35b6001600160a01b0381160361000e57565b90600182811c921680156102c6575b60208310146102b057565b634e487b7160e01b600052602260045260246000fd5b91607f16916102a5565b90604051918260008254926102e484610296565b9081845260019485811690816000146103535750600114610310575b505061030e92500383610159565b565b9093915060005260209081600020936000915b81831061033b57505061030e93508201013880610300565b85548884018501529485019487945091830191610323565b91505061030e94506020925060ff191682840152151560051b8201013880610300565b60005b8381106103895750506000910152565b8181015183820152602001610379565b906020916103b281518092818552858086019101610376565b601f01601f1916010190565b503461000e57602036600319011261000e576001600160a01b036004356103e481610285565b166000526000602052604060002080546101086104086002600185015494016102d0565b60405193849384526020840152606060408401526060830190610399565b604051906020820182811067ffffffffffffffff82111761044b575b60405260008252565b610453610119565b610442565b503461000e57600036600319011261000e5761010860405161047981610130565b602281527f506173734b657973204f776e657273686970205265676973747279204d6f64756020820152616c6560f01b6040820152604051918291602083526020830190610399565b503461000e57600036600319011261000e576101086040516040810181811067ffffffffffffffff821117610533575b604052600581527f302e322e300000000000000000000000000000000000000000000000000000006020820152604051918291602083526020830190610399565b61053b610119565b6104f2565b503461000e5760031960403682011261000e576004359067ffffffffffffffff821161000e5761016090823603011261000e5761058560209160243590600401610928565b604051908152f35b90601f811161059b57505050565b600091825260208220906020601f850160051c830194106105d7575b601f0160051c01915b8281106105cc57505050565b8181556001016105c0565b90925082906105b7565b92919092600091338352602093838552604084205415158061074d575b61073557600291610625916040519461061686610130565b855286850197885236916101c6565b946040830195865261064a336001600160a01b03166000526000602052604060002090565b925183555191600192838201550193519182519267ffffffffffffffff8411610728575b6106828461067c8854610296565b8861058d565b8491601f85116001146106bc5793945084929190836106b1575b50501b916000199060031b1c19161790553090565b01519250388061069c565b92948490601f198216906106d589600052602060002090565b95905b8883831061070e57505050106106f5575b505050811b0190553090565b015160001960f88460031b161c191690553880806106e9565b8587015188559096019594850194879350908101906106d8565b610730610119565b61066e565b604051632c4dfb7d60e21b8152336004820152602490fd5b50600161076d336001600160a01b03166000526000602052604060002090565b015415156105fe565b903590601e198136030182121561000e570180359067ffffffffffffffff821161000e5760200191813603831361000e57565b919060408382031261000e57823567ffffffffffffffff811161000e576020916107d49185016101fd565b92013561021881610285565b81601f8201121561000e5780516107f68161019b565b926108046040519485610159565b8184526020828401011161000e576102189160208085019101610376565b919060408382031261000e57825167ffffffffffffffff811161000e5760209161084d9185016107e0565b92015190565b519065ffffffffffff8216820361000e57565b9060a08282031261000e5761087a82610853565b92602090610889828501610853565b9360408101519360608201519367ffffffffffffffff9485811161000e5783019082601f8301121561000e5781519186831161091b575b8260051b604051936108d484830186610159565b845282808501918301019185831161000e578301905b82821061090c575050505093608083015190811161000e5761021892016107e0565b815181529083019083016108ea565b610923610119565b6108c0565b61094561093d61095592610140810190610776565b8101906107a9565b5060208082518301019101610822565b15610a0a576109e86109e4610976836020806109db96518301019101610866565b968298919492936109cd6040519384926020840196879190602c93917fffffffffffff0000000000000000000000000000000000000000000000000000809260d01b16845260d01b166006830152600c8201520190565b03601f198101835282610159565b51902091610a13565b1590565b610a03576109f591610b20565b6109fe57600190565b600090565b5050600190565b6109f591610b20565b9091906000915b8151831015610a77576020808460051b84010151916000838210600014610a67575060005252600160406000205b926000198114610a5a575b0191610a1a565b610a62610a7e565b610a53565b9060409260019483525220610a48565b9150501490565b50634e487b7160e01b600052601160045260246000fd5b90610a9f91610b20565b610ac7577fffffffff0000000000000000000000000000000000000000000000000000000090565b630b135d3f60e11b90565b906040516060810181811067ffffffffffffffff821117610b13575b6040526040610b0e600283958054855260018101546020860152016102d0565b910152565b610b1b610119565b610aee565b815182019160209283810190848382031261000e57848301519267ffffffffffffffff9384811161000e5760c091018092031261000e57610b5f61017b565b928582015181811161000e578387610b79928501016107e0565b8452604082015190811161000e5760c09286610b97928401016107e0565b85840152606081015160408401526080810151606084015260a08101516080840152015160a0820152610be5610be0336001600160a01b03166000526000602052604060002090565b610ad2565b9081511580610c38575b610c2057604051848101938452928390038084526102189490610c159060200185610159565b825192015192610d7a565b60405163ce777ecf60e01b8152336004820152602490fd5b508382015115610bef565b9060158201809211610c5157565b61030e610a7e565b9060028201809211610c5157565b91908201809211610c5157565b90610c8760209282815194859201610376565b0190565b9061030e602e60405180947f226368616c6c656e6765223a22000000000000000000000000000000000000006020830152610cd0815180926020602d86019101610376565b8101601160f91b602d82015203600e810185520183610159565b805160201015610cfa5760400190565b634e487b7160e01b600052603260045260246000fd5b506040513d6000823e3d90fd5b6020929190610d33849282815194859201610376565b019081520190565b3d15610d66573d90610d4c8261019b565b91610d5a6040519384610159565b82523d6000602084013e565b606090565b9081602091031261000e575190565b9291909260a084017f7fffffff800000007fffffffffffffffde737d56d38bcf4279dce5617e3192a8815111610fb657602094858101927fff1a2a9176d650e4a99dedb58f1793003935130579fe17b5a3f698ac5b00e634610deb85516060850151610de581610c43565b91611129565b88815191012003610faa57610e0b610e1091610e05610fc0565b90611081565b610c8b565b610e2584516040840151610de5845182610c67565b8781519101209087815191012003610f9f57600160f81b80610e70610e4a8451610cea565b517fff000000000000000000000000000000000000000000000000000000000000001690565b1603610f9f576080925186604051918280610e8e6000958694610c74565b039060025afa15610f92575b808051928882610ed68351610eb6604051988992868401610d1d565b0396610eca601f1998898101835282610159565b60405191828092610c74565b039060025afa15610f85575b81519586910193610f318551918b610f258c8c8b516040519788958601998a9192608093969594919660a084019784526020840152604083015260608201520152565b03908101835282610159565b51906101005afa95610f41610d3b565b9081519780610f7c575b610f5f5750506102189550519051916111d7565b600197610f789750820181019550019250610d6b915050565b1490565b50871515610f4b565b610f8d610d10565b610ee2565b610f9a610d10565b610e9a565b505050505050600090565b50505050505050600090565b5050505050600090565b60405190610fcd82610130565b604082527f6768696a6b6c6d6e6f707172737475767778797a303132333435363738392d5f6040837f4142434445464748494a4b4c4d4e4f505152535455565758595a61626364656660208201520152565b908160021b917f3fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff811603610c5157565b906110598261019b565b6110666040519182610159565b8281528092611077601f199161019b565b0190602036910137565b80511561111f576110ac6110a76110a061109b845161101f565b610c59565b6003900490565b61104f565b91602083019180805101906020820192835194600085525b8383106110d357505050505290565b6004906003809401938451600190603f9082828260121c16880101518553828282600c1c16880101518386015382828260061c16880101516002860153168501015190820153016110c4565b5050610218610426565b8051606094939290838111156111a4575b8181111561119c575b5082811061115057505050565b60405192819003808452929450601f19929183910181601f840181165b8083015181890152019081156111855790829061116d565b505060008583016020015250603f01168201604052565b905038611143565b92508261113a565b907bffffffff00000000000000004319055258e8617b0c46353d039cdaae19918203918211610c5157565b9391909293831580156112cd575b80156112c5575b801561129e575b610fb65761120183866112f4565b15610fb65760405191602083526020808401526020604084015260608301527fffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc63254f60808301527bffffffff00000000000000004319055258e8617b0c46353d039cdaae19948560a084015260208360c0816005600019fa1561000e576112989386611292945181818909940991611395565b916111ac565b90081590565b507bffffffff00000000000000004319055258e8617b0c46353d039cdaae198210156111f3565b5081156111ec565b507bffffffff00000000000000004319055258e8617b0c46353d039cdaae198410156111e5565b600160601b63ffffffff60c01b03199081811080159061138b575b801561137a575b611372577f5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b828281807fffffffff00000001000000000000000000000000fffffffffffffffffffffffc81960991818180090908089180091490565b505050600090565b508015801561131657508215611316565b508183101561130f565b91600092600060ff93831580611c92575b610faa576113b48184611c9a565b9095861580611c8a575b611c3c575b85811c60028a60fe1c16015b15611c2257600186821c1660028a831c60011b160160018114611bd7575b60028114611bc8575b600314611bbb575b6001986000199190910196939493899392915b88600019116114815750505050505050505060405191606083015260208252602080830152602060408301526002600160601b0363ffffffff60c01b03196080830152600160601b63ffffffff60c01b0319918260a082015260208160c0816005600019fa1561000e5751900990565b909192939495969798600160601b63ffffffff60c01b031988600209600160601b63ffffffff60c01b0319818009988991600160601b63ffffffff60c01b03198385099a600160601b63ffffffff60c01b03199109918d8394600160601b63ffffffff60c01b031982820891600160601b63ffffffff60c01b031903600160601b63ffffffff60c01b0319910890600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b03199060030998600160601b63ffffffff60c01b03199084099d600160601b63ffffffff60c01b0319910997600160601b63ffffffff60c01b03198b6002600160601b0363ffffffff60c01b031909600160601b63ffffffff60c01b031982800990600160601b63ffffffff60c01b031991089a600160601b63ffffffff60c01b031903600160601b63ffffffff60c01b0319908c08600160601b63ffffffff60c01b03199109928391600160601b63ffffffff60c01b0319910990600160601b63ffffffff60c01b03199108918a8c1c600116848d1c60011b6002160115611b9e5760018c600286838f841c16921c831b160114611b55575b838c8c6002600182841c168185851c60011b160114611b42575b6003926001600292841c16921c60011b160114611b39575b8715611b2657600160601b63ffffffff60c01b031983818f819409089181898c8203920908968115611825575b600160601b63ffffffff60c01b0319888009600160601b63ffffffff60c01b031991099b87600160601b63ffffffff60c01b031981800990600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b0319910998600160601b63ffffffff60c01b0319888009600160601b63ffffffff60c01b0319910991600160601b63ffffffff60c01b0319836002600160601b0363ffffffff60c01b03190988600160601b63ffffffff60c01b031981800990600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b031903600160601b63ffffffff60c01b031984800990600160601b63ffffffff60c01b0319910890600160601b63ffffffff60c01b0319910897600160601b63ffffffff60c01b031981800990600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b031991099187600160601b63ffffffff60c01b031903600160601b63ffffffff60c01b0319910890600160601b63ffffffff60c01b0319910990600160601b63ffffffff60c01b0319910894985b60001901979694959493929190611411565b876116865798919a96505087600160601b63ffffffff60c01b03198b6002600160601b0363ffffffff60c01b031909600160601b63ffffffff60c01b03198c6002600160601b0363ffffffff60c01b03190990600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b031990830991600160601b63ffffffff60c01b0319828103820891600160601b63ffffffff60c01b0319910890600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b0319906003099a600160601b63ffffffff60c01b03198b6002600160601b0363ffffffff60c01b031909600160601b63ffffffff60c01b03198c6002600160601b0363ffffffff60c01b03190990600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b03198c6002600160601b0363ffffffff60c01b03190990600160601b63ffffffff60c01b0319910990600160601b63ffffffff60c01b0319910997600160601b63ffffffff60c01b03198b6002600160601b0363ffffffff60c01b031909600160601b63ffffffff60c01b03198c6002600160601b0363ffffffff60c01b03190990600160601b63ffffffff60c01b0319910990600160601b63ffffffff60c01b031991099a600160601b63ffffffff60c01b0319826002600160601b0363ffffffff60c01b031909600160601b63ffffffff60c01b031982800990600160601b63ffffffff60c01b031991089a600160601b63ffffffff60c01b0319816002600160601b0363ffffffff60c01b031909600160601b63ffffffff60c01b0319826002600160601b0363ffffffff60c01b03190990600160601b63ffffffff60c01b03199109600160601b63ffffffff60c01b0319826002600160601b0363ffffffff60c01b03190990600160601b63ffffffff60c01b0319910990600160601b63ffffffff60c01b03199109918b600160601b63ffffffff60c01b031903600160601b63ffffffff60c01b03199108600160601b63ffffffff60c01b0319910990600160601b63ffffffff60c01b0319910894611813565b60019c50909a8c99509096509050611813565b50508284611659565b508a93508892508591508d90508c611641565b50507f6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c2967f4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5611627565b5050600160601b63ffffffff60c01b03199a9799959a0394611813565b92509550849580926113fe565b949750879492935083926113f6565b7f6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c29698507f4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f594506113ed565b60001901600160028188841c16918b841c901b16016113cf565b9790947bffffffff00000000000000004319055258e8617b0c46353d039cdaae1991820390089384976000981580611c82575b156113c357505050505050505050600090565b506001611c6f565b5081156113be565b5086156113a6565b7f4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f592917f6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296918115611e095780831480611e00575b15611de9575050600160601b63ffffffff60c01b0319908184600209918083800992818080808781818909950995817fffffffff00000001000000000000000000000000fffffffffffffffffffffffe816001840892080960030981808080866002600160601b0363ffffffff60c01b03190981858009089981600181818b099a099709810393898203900890090893915b60405190602082526020808301526020604083015260608201526002600160601b0363ffffffff60c01b03196080820152600160601b63ffffffff60c01b0319928360a083015260208260c0816005600019fa1561000e57838080935180950980099009930990565b909150611df7929350611e0f565b91939291611d80565b50818514611cee565b50509190565b60019283927f94e82e0c1ed3bdb90743191a9c5bbf0d88fc827fd214cc5f0b5ec6ba27673d69600160601b63ffffffff60c01b03198095818094817fb01cbd1c01e58065711814b583f061e9d431cca994cea1313449bf97c840ae0a9a8b9209089509089280808080878009968709948180887f6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c29609918180898180876002600160601b0363ffffffff60c01b031909818381038188800908089c09938b82039008090894600109926001099056fea264697066735822122086b3e1b1eba43136650b1f730f8a7b61d83cf7e83bdca30708be76cc2abd66aa64736f6c63430008110033`;

const passkeyAddress = '0x958ec8f1BE3aD4Cd2e4a18316Cd7Aab8AD3a6811';
export const deployPassKeyModule = async (chainId: number, signer: Wallet) => {
    const rpcUrl = getBundlerChainConfig(chainId).rpcUrl;
    const network = new Network('', chainId);
    const fetchRequest = new FetchRequest(rpcUrl);
    fetchRequest.timeout = PROVIDER_FETCH_TIMEOUT;
    const provider = new JsonRpcProvider(fetchRequest, network, { batchMaxCount: 1, staticNetwork: network });
    signer = signer.connect(provider);

    const feeData = await provider.getFeeData();

    const code = await provider.getCode(passkeyAddress);
    if (code.length > 2) {
        console.log('Passk module already deployed');
        return;
    }
    console.log(JSON.stringify(feeData))
    let gasPrice: any = feeData.gasPrice;
    let maxFeePerGas: any = null;
    let maxPriorityFeePerGas: any = null;

    const r = await signer.sendTransaction({
        type: 0,
        to: '0x4e59b44847b379578588920ca78fbf26c0b4956c',
        data,
        gasPrice,
        maxFeePerGas,
        maxPriorityFeePerGas,
    });

    console.log(r);
};
